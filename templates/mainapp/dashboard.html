{% extends 'base.html'%}
{% load static %}

{% block title%}
  KarunaTrader | Dashboard
{% endblock %}

{% block content %}

    <!-- Select Season Form-->
    <form method="get" class="form-inline mb-4">
      <label for="seasonSelect" class="mr-2">Select Season:</label>
      <select name="year" class="form-control mr-2">
        {% for y, s in available_seasons %}
          {% if s == selected_season and y == selected_year %}
            <option value="{{ y }}" selected>{{ y }}</option>
          {% else %}
            <option value="{{ y }}">{{ y }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <select name="season" class="form-control mr-2">
        <option value="1" {% if selected_season == 1 %}selected{% endif %}>Season 1 (Apr–Jun)</option>
        <option value="2" {% if selected_season == 2 %}selected{% endif %}>Season 2 (Oct–Dec)</option>
      </select>
      <button type="submit" class="btn btn-primary">Go</button>
    </form>

<div class="container-fluid mt-4">
  <h2 class="mb-4">Dashboard Overview</h2>

  <div class="row">
    <!-- Total Buyers -->
    <div class="col-lg-3 col-6">
    <a href="{% url 'people:buyer-list' %}" >
      <div class="small-box bg-info">
        <div class="inner">
          <h3>{{ total_buyers }}</h3>
          <p>Total Buyers</p>
        </div>
        <div class="icon">
          <i class="fas fa-users"></i>
        </div>
      </div>
    </a>
    </div>

    <!-- Total Farmers -->
    <div class="col-lg-3 col-6">
    <a href="{% url 'people:farmer-list' %}" >
      <div class="small-box bg-secondary">
        <div class="inner">
          <h3>{{ total_farmers }}</h3>
          <p>Total Farmers</p>
        </div>
        <div class="icon">
          <i class="fas fa-tractor"></i>
        </div>
      </div>
    </a>
    </div>

    <!-- Total Purchases -->
    <div class="col-lg-3 col-6">
    <a href="{% url 'purchases:purchasebill-list' %}" >
      <div class="small-box bg-warning">
        <div class="inner">
          <h3>{{ total_purchase_kg }} kg</h3>
          <p>Purchased (Total)</p>
        </div>
        <div class="icon">
          <i class="fas fa-arrow-down"></i>
        </div>
      </div>
    </a>
    </div>

    <!-- Total Sales -->
    <div class="col-lg-3 col-6">
    <a href="{% url 'sales:salesbill-list' %}" >
      <div class="small-box bg-primary">
        <div class="inner">
          <h3>{{ total_sale_kg }} kg</h3>
          <p>Sold (Total)</p>
        </div>
        <div class="icon">
          <i class="fas fa-arrow-up"></i>
        </div>
      </div>
    </a>
    </div>


    <!-- Profit -->
    <div class="col-lg-6 col-12">
        <div {% if profit <= 0 %} class="small-box bg-danger" {% else %} class="small-box bg-success" {% endif %}>
            <div class="inner">
              <h3>Rs. {{ profit }}</h3>
              <p>Net Profit</p>
            </div>
            <div class="icon">
              <i class="fas fa-coins"></i>
            </div>
        </div>
    </div>

  <!-- Total Purchases -->
    <div class="col-lg-3 col-6">
    <a href="{% url 'purchases:purchasebill-list' %}" >
      <div class="small-box bg-gradient-danger">
        <div class="inner">
          <h3>Nrs: {{ total_purchase_value|floatformat:"0"  }} </h3>
          <p>Purchased (Total)</p>
        </div>
        <div class="icon">
          <i class="fas fa-credit-card"></i>
        </div>
      </div>
    </a>
    </div>

    <!-- Total Income -->
    <div class="col-lg-3 col-6">
    <a href="{% url 'sales:salesbill-list' %}" >
      <div class="small-box bg-gradient-success">
        <div class="inner">
          <h3>Nrs: {{ total_sale_value|floatformat:"0"  }}</h3>
          <p>Sales : (Total)</p>
        </div>
        <div class="icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
      </div>
    </a>
    </div>
  </div>

  <div class="row">

    <div class="col-lg-6 col-12 card">
        <div class="card">
        </div>
    </div>

    <div class="col-lg-6 col-12 card">
        <div class="card-body">
        <h5>Top Sold Products</h5>
        <table class="table table-sm">
          <thead><tr><th>Product</th><th>Weight (kg)</th><th>Revenue (Rs)</th></tr></thead>
          <tbody>
            {% for p in top_sold_products %}
              <tr>
                <td>{{ p.product__name }}</td>
                <td>{{ p.total_weight }}</td>
                <td>{{ p.total_revenue }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="3">No data</td></tr>
            {% endfor %}
          </tbody>
        </table>
        </div>
    </div>
  </div>
</div>
{% endblock %}
